<!doctype html>

<html lang="hi">  
<head>  
<meta charset="utf-8" />  
<meta name="viewport" content="width=device-width,initial-scale=1" />  
<title>3D Car Racing — Final</title>  
<style>  
html,body{height:100%;margin:0;padding:0;overflow:hidden;background:linear-gradient(180deg,#87CEEB 0%,#6aa0d8 60%);font-family:Inter,system-ui,Segoe UI,Roboto,'Noto Sans',sans-serif}  
#ui{position:fixed;left:14px;top:14px;z-index:60;display:none;gap:12px;align-items:center;padding:10px;border-radius:12px;background:rgba(0,0,0,0.16);backdrop-filter:blur(6px)}  
.score{color:#00d4ff;font-weight:800}  
.btn{appearance:none;border:2px solid;border-image:linear-gradient(90deg,#00d4ff,#7c5cff) 1;background:transparent;padding:8px 12px;border-radius:10px;color:#00d4ff;font-weight:700;cursor:pointer;transition:transform .12s}  
.btn:active{transform:scale(.96)}  
#overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:70}  
.panel{background:rgba(3,6,14,0.7);padding:20px;border-radius:14px;color:#fff;text-align:center;backdrop-filter:blur(6px)}  
#tapScreen{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:80;background:rgba(0,0,0,0.35);backdrop-filter:blur(6px)}  
#tapScreen button{font-size:26px;padding:16px 32px;border-radius:16px}  
.touch-controls{position:fixed;left:0;right:0;bottom:18px;display:none;justify-content:center;gap:18px;z-index:65}  
.touch-btn{width:88px;height:56px;border-radius:14px;border:2px solid;border-image:linear-gradient(90deg,#00d4ff,#7c5cff) 1;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center;font-weight:800;color:#00d4ff;font-size:20px}  
canvas{display:block;position:fixed;top:0;left:0;width:100%;height:100%;}  
@media(max-width:720px){#ui{left:8px;top:8px;padding:8px}}  
</style>  
</head>  
<body>  
<div id="ui"><div style="font-size:12px;opacity:.85">SCORE</div><div id="score" class="score">0</div><button id="restartBtn" class="btn">Restart</button></div>  
<div id="overlay"><div class="panel"><div style="font-size:22px;font-weight:900">Game Over</div><div id="final" style="margin-top:8px;font-size:16px">Score: 0</div><div style="margin-top:12px"><button id="overlayRestart" class="btn">Play Again</button></div></div></div>  
<div id="tapScreen"><button class="btn" id="tapPlay">Tap to Play</button></div>  
<div class="touch-controls" id="touchControls"><div id="leftTouch" class="touch-btn">◀</div><div id="rightTouch" class="touch-btn">▶</div></div>  
<script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>  
<script>  
let scene,camera,renderer;let player;const clock=new THREE.Clock();let obstacles=[],trees=[],buildings=[],grass=[];let score=0;let running=false;let gameStarted=false;let spawnTimer=0;const ROAD_WIDTH=10;const LANES=[-3.6,0,3.6];let currentLane=1;let laneSwitching=false;let baseSpeed=70;let playerSpeed=baseSpeed;function startGame(){if(gameStarted) return;document.getElementById('tapScreen').style.display='none';document.getElementById('ui').style.display='flex';document.getElementById('touchControls').style.display='flex';running=true;gameStarted=true;spawnTimer=0;score=0;document.getElementById('score').innerText='0'}function init(){renderer=new THREE.WebGLRenderer({antialias:true});renderer.setPixelRatio(Math.min(window.devicePixelRatio||1,2));renderer.setSize(window.innerWidth,window.innerHeight);renderer.shadowMap.enabled=true;document.body.appendChild(renderer.domElement);scene=new THREE.Scene();scene.background=new THREE.Color(0x87CEEB);scene.fog=new THREE.FogExp2(0x87CEEB,0.00085);camera=new THREE.PerspectiveCamera(62,window.innerWidth/window.innerHeight,0.1,4000);camera.position.set(0,5,14);const hemi=new THREE.HemisphereLight(0xffffe0,0x444444,0.75);scene.add(hemi);const dir=new THREE.DirectionalLight(0xfff1c7,0.9);dir.position.set(-30,60,-10);dir.castShadow=true;dir.shadow.camera.left=-800;dir.shadow.camera.right=800;dir.shadow.camera.top=800;dir.shadow.camera.bottom=-800;dir.shadow.mapSize.set(2048,2048);scene.add(dir);addRoad();addGrass();addSun();addMountains();populateSides();player=createPlayerCar(0xff4b4b);player.position.set(LANES[currentLane],0.6,0);scene.add(player);for(let i=0;i<6;i++) spawnObstacle(true);window.addEventListener('resize',onResize);window.addEventListener('keydown',onKeyDown);window.addEventListener('keyup',onKeyUp);document.getElementById('restartBtn').addEventListener('click',restartGame);document.getElementById('overlayRestart').addEventListener('click',restartGame);document.getElementById('tapPlay').addEventListener('click',startGame);setUpTouchButtons();animate()}function addRoad(){const roadGeo=new THREE.PlaneGeometry(ROAD_WIDTH,8000);const roadMat=new THREE.MeshStandardMaterial({color:0x1f262a,roughness:0.92});const road=new THREE.Mesh(roadGeo,roadMat);road.rotation.x=-Math.PI/2;road.position.set(0,0,-2000);road.receiveShadow=true;scene.add(road);const laneLineGeo=new THREE.BoxGeometry(0.12,0.02,8000);const laneLineMat=new THREE.MeshBasicMaterial({color:0x666666});const leftLine=new THREE.Mesh(laneLineGeo,laneLineMat);const rightLine=leftLine.clone();leftLine.position.set(-ROAD_WIDTH/6,0.02,-4000);rightLine.position.set(ROAD_WIDTH/6,0.02,-4000);scene.add(leftLine);scene.add(rightLine);const stripeGeo=new THREE.BoxGeometry(0.28,0.02,12);const stripeMat=new THREE.MeshBasicMaterial({color:0xffffff});for(let z=0;z>-8000;z-=28){const s=new THREE.Mesh(stripeGeo,stripeMat);s.position.set(0,0.02,z);scene.add(s);}const sideGeo=new THREE.BoxGeometry(0.2,0.02,8000);const sideMat=new THREE.MeshBasicMaterial({color:0xcccccc});const left=new THREE.Mesh(sideGeo,sideMat);left.position.set(-ROAD_WIDTH/2+0.15,0.02,-4000);scene.add(left);const rightEdge=left.clone();rightEdge.position.x=ROAD_WIDTH/2-0.15;scene.add(rightEdge)}function addGrass(){const grassGeo=new THREE.PlaneGeometry(1200,8000);const grassMat=new THREE.MeshStandardMaterial({color:0x3fa63f,roughness:0.95});const left=new THREE.Mesh(grassGeo,grassMat);left.rotation.x=-Math.PI/2;left.position.set(-ROAD_WIDTH/2-600,0,-4000);scene.add(left);grass.push(left);const right=left.clone();right.position.x=ROAD_WIDTH/2+600;scene.add(right);grass.push(right)}function addSun(){const g=new THREE.SphereGeometry(6,32,24);const m=new THREE.MeshBasicMaterial({color:0xffd36b});const s=new THREE.Mesh(g,m);s.position.set(-120,120,-800);scene.add(s)}function addMountains(){const baseZ=-2000;for(let i=0;i<8;i++){const h=120+Math.random()*220;const geo=new THREE.ConeGeometry(300+Math.random()*120,h,6);const mat=new THREE.MeshLambertMaterial({color:0x4d6b8a});const m=new THREE.Mesh(geo,mat);m.position.set(-1200+i*700,-80,baseZ-i*1000);m.rotation.y=Math.PI/7;scene.add(m)}}function populateSides(){for(let i=0;i<36;i++){const w=12+Math.random()*36;const h=12+Math.random()*80;const d=8+Math.random()*24;const geo=new THREE.BoxGeometry(w,h,d);const mat=new THREE.MeshStandardMaterial({color:new THREE.Color().setHSL(Math.random()*0.1+0.55,0.35,0.48)});const b=new THREE.Mesh(geo,mat);b.position.set((i%2===0?-1:1)*(ROAD_WIDTH/2+80+Math.random()*220),h/2-2,-60-i*260);b.castShadow=true;b.receiveShadow=true;scene.add(b);buildings.push(b)}for(let i=0;i<220;i++){const tr=createTree();const side=(i%2===0)?-1:1;tr.position.set(side*(ROAD_WIDTH/2+40+Math.random()*280),0,-10-Math.random()*7200);scene.add(tr);trees.push(tr)}for(const g of grass){g.receiveShadow=true}}function createTree(){const g=new THREE.Group();const trunk=new THREE.Mesh(new THREE.CylinderGeometry(0.4,0.4,3,8),new THREE.MeshStandardMaterial({color:0x6b3f1a}));trunk.position.y=1.5;const leaves=new THREE.Mesh(new THREE.ConeGeometry(3.5,8,8),new THREE.MeshStandardMaterial({color:0x147a2b}));leaves.position.y=4;g.add(trunk);g.add(leaves);return g}function createPlayerCar(color){const g=new THREE.Group();const body=new THREE.Mesh(new THREE.BoxGeometry(2.2,0.7,4.0),new THREE.MeshStandardMaterial({color:color,metalness:0.25,roughness:0.35}));body.position.y=0.6;g.add(body);const roof=new THREE.Mesh(new THREE.BoxGeometry(1.2,0.5,1.4),new THREE.MeshStandardMaterial({color:0x1b2b34,metalness:0.05,roughness:0.2}));roof.position.set(0,1.1,0.3);g.add(roof);const bumper=new THREE.Mesh(new THREE.BoxGeometry(2.0,0.25,0.6),new THREE.MeshStandardMaterial({color:0x111315}));bumper.position.set(0,0.45,1.7);g.add(bumper);const wheelGeo=new THREE.CylinderGeometry(0.44,0.44,0.6,12);const wheelMat=new THREE.MeshStandardMaterial({color:0x0b0b0b});function addWheel(x,z){const w=new THREE.Mesh(wheelGeo,wheelMat);w.rotation.z=Math.PI/2;w.position.set(x,0.36,z);g.add(w)}addWheel(-1.05,1.8);addWheel(1.05,1.8);addWheel(-1.05,-1.5);addWheel(1.05,-1.5);g.castShadow=true;g.receiveShadow=true;return g}function createObstacleCar(color){return createPlayerCar(color)}function spawnObstacle(initial=false){const laneIndex=Math.floor(Math.random()*LANES.length);const color=Math.random()>0.5?0x1e90ff:0xffc857;const car=createObstacleCar(color);const z=initial?player.position.z-200-Math.random()*1200:player.position.z-800-Math.random()*600;car.position.set(LANES[laneIndex],0.6,z);car.userData.speed=playerSpeed*(0.6+Math.random()*0.8);scene.add(car);obstacles.push(car)}function setUpTouchButtons(){const lt=document.getElementById('leftTouch');const rt=document.getElementById('rightTouch');lt.addEventListener('touchstart',()=>{tryLaneLeft()});lt.addEventListener('touchend',()=>{});rt.addEventListener('touchstart',()=>{tryLaneRight()});rt.addEventListener('touchend',()=>{});let sx=null;window.addEventListener('touchstart',(e)=>{if(e.touches&&e.touches.length===1)sx=e.touches[0].clientX});window.addEventListener('touchmove',(e)=>{if(sx===null)return;const dx=e.touches[0].clientX-sx;if(Math.abs(dx)>40){if(dx<0){tryLaneLeft()}else{tryLaneRight()}sx=e.touches[0].clientX}});window.addEventListener('touchend',()=>{sx=null})}function onKeyDown(e){if(e.repeat) return;if(!gameStarted) return;if(e.key==='ArrowLeft'||e.key==='a'){tryLaneLeft()}if(e.key==='ArrowRight'||e.key==='d'){tryLaneRight()}}function onKeyUp(e){}function tryLaneLeft(){if(laneSwitching) return;const target=currentLane-1;if(target<0) return;currentLane=target;laneSwitching=true}function tryLaneRight(){if(laneSwitching) return;const target=currentLane+1;if(target>LANES.length-1) return;currentLane=target;laneSwitching=true}function animate(){requestAnimationFrame(animate);const dt=clock.getDelta();if(!gameStarted){renderer.render(scene,camera);return}if(!running){renderer.render(scene,camera);return}const moveSpeed=8;const targetX=LANES[currentLane];const dx=targetX-player.position.x;if(Math.abs(dx)>0.02){player.position.x+=Math.sign(dx)*Math.min(Math.abs(dx),moveSpeed*dt);player.rotation.z=THREE.MathUtils.lerp(player.rotation.z,Math.sign(dx)*-0.22,0.15)}else{player.position.x=targetX;player.rotation.z=THREE.MathUtils.lerp(player.rotation.z,0,0.12);laneSwitching=false}player.position.z-=playerSpeed*dt;camera.position.x+=(player.position.x-camera.position.x)*0.12;const desiredCamY=5+Math.min(4,Math.abs((playerSpeed-baseSpeed)/30));camera.position.y+=(desiredCamY-camera.position.y)*0.06;camera.position.z=player.position.z+12-Math.min(8,(playerSpeed-baseSpeed)/12);camera.lookAt(player.position.x,0,player.position.z-8);spawnTimer+=dt;const spawnInterval=Math.max(0.35,1.6-score/240);if(spawnTimer>spawnInterval){spawnTimer=0;spawnObstacle()}for(let i=obstacles.length-1;i>=0;i--){const ob=obstacles[i];ob.position.z+=ob.userData.speed*dt;const pBox=new THREE.Box3().setFromObject(player);const oBox=new THREE.Box3().setFromObject(ob);if(pBox.intersectsBox(oBox)){endGame();return}if(ob.position.z>camera.position.z+60){scene.remove(ob);obstacles.splice(i,1)}}for(const t of trees){t.position.z+=playerSpeed*dt*0.08}for(const b of buildings){b.position.z+=playerSpeed*dt*0.03}for(const g of grass){g.position.z+=playerSpeed*dt*0.03}respawnSides();score+=dt*(playerSpeed/6);document.getElementById('score').innerText=Math.floor(score);renderer.render(scene,camera)}function respawnSides(){for(const t of trees){if(t.position.z>camera.position.z+200){t.position.z-=9600+Math.random()*3200;t.position.x=(Math.random()>0.5?1:-1)*(ROAD_WIDTH/2+30+Math.random()*280)}}for(const b of buildings){if(b.position.z>camera.position.z+400){b.position.z-=9600;b.position.x=(Math.random()>0.5?-1:1)*(ROAD_WIDTH/2+40+Math.random()*160)}}for(const g of grass){if(g.position.z>camera.position.z+400){g.position.z-=9600}}}function endGame(){running=false;document.getElementById('overlay').style.display='flex';document.getElementById('final').innerText='Score: '+Math.floor(score)}function restartGame(){obstacles.forEach(o=>scene.remove(o));obstacles=[];score=0;running=false;gameStarted=false;document.getElementById('score').innerText='0';document.getElementById('overlay').style.display='none';document.getElementById('tapScreen').style.display='flex';document.getElementById('ui').style.display='none';document.getElementById('touchControls').style.display='none';currentLane=1;laneSwitching=false;player.position.set(LANES[currentLane],0.6,0);camera.position.set(0,5,14);playerSpeed=baseSpeed;spawnTimer=0;for(let i=0;i<6;i++)spawnObstacle(true)}function onResize(){camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight)}init();  
</script>  
</body>  
</html>
